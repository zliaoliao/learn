

éå¸¸å¥½çš„é—®é¢˜ï¼

âœ… ä½ é—®çš„è¿™ä¸ªç‚¹éå¸¸åˆ°ä½ï¼š  
**ä¸ä»…è¦çŸ¥é“Vueæœ‰è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œè¿˜è¦çŸ¥é“åœ¨çœŸå®ä¸šåŠ¡ä¸­ï¼ŒæŒ‡ä»¤åˆ°åº•æ€ä¹ˆç”¨ï¼Œæ€ä¹ˆåˆç†ä½¿ç”¨ã€‚**

**åªçŸ¥é“æŒ‡ä»¤ç”Ÿå‘½å‘¨æœŸæˆ–è€…APIæ˜¯åˆçº§æ°´å¹³ï¼Œ**  
**èƒ½ç»“åˆçœŸå®ä¸šåŠ¡åœºæ™¯è®²å‡ºä½¿ç”¨æ¡ˆä¾‹ï¼Œæ‰æ˜¯é«˜çº§å‰ç«¯é¢è¯•çœŸæ­£æƒ³çœ‹çš„ï¼**

---

# ğŸ“š Vueè‡ªå®šä¹‰æŒ‡ä»¤åœ¨çœŸå®ä¸šåŠ¡ä¸­çš„å¸¸è§åº”ç”¨

å¸¸ç”¨åœºæ™¯æ€»ç»“ï¼ˆçœŸå®ä¸šåŠ¡ï¼‰ï¼š

| åœºæ™¯ | æè¿° |
|:----|:----|
| æƒé™æ§åˆ¶ | æŸäº›æŒ‰é’®/å…ƒç´ åªæœ‰ç‰¹å®šæƒé™ç”¨æˆ·æ‰èƒ½çœ‹åˆ°æˆ–æ“ä½œ |
| å›¾ç‰‡æ‡’åŠ è½½ | åªåŠ è½½å‡ºç°åœ¨è§†å£èŒƒå›´å†…çš„å›¾ç‰‡ï¼ŒèŠ‚çœå¸¦å®½ |
| é˜²æŠ–èŠ‚æµå¤„ç† | æ§åˆ¶æŒ‰é’®ç‚¹å‡»é¢‘ç‡ã€é˜²æ­¢é‡å¤æäº¤ |
| æ‹–æ‹½åŠŸèƒ½ | è®©å…ƒç´ æ”¯æŒæ‹–æ‹½æ“ä½œ |
| è‡ªåŠ¨èšç„¦è¾“å…¥æ¡† | è¡¨å•é¡µè¿›å…¥åè‡ªåŠ¨èšç„¦åˆ°ç¬¬ä¸€ä¸ªè¾“å…¥ |
| åŠ¨æ€tooltipæç¤º | é¼ æ ‡æ‚¬æµ®æ—¶åŠ¨æ€æŒ‚è½½æç¤ºæ¡†ç»„ä»¶ |

---

# ğŸ¯ ç»™ä½ ä¸¾ä¸€ä¸ª**çœŸå®ä¸šåŠ¡åœºæ™¯çš„å…·ä½“ä¾‹å­**ï¼š

---

## âœ… çœŸå®æ¡ˆä¾‹ï¼šæŒ‰é’®çº§æƒé™æ§åˆ¶ï¼ˆè‡ªå®šä¹‰æŒ‡ä»¤ï¼‰

> åœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œä¸åŒç”¨æˆ·æœ‰ä¸åŒæƒé™ï¼Œ  
> æœ‰äº›æŒ‰é’®ï¼ˆæ¯”å¦‚â€œåˆ é™¤ç”¨æˆ·â€ã€â€œå¯¼å‡ºæ•°æ®â€ï¼‰åªæœ‰ç‰¹å®šæƒé™æ‰èƒ½çœ‹åˆ°ã€‚

---

**é—®é¢˜ï¼š**
- ä¸èƒ½åœ¨æ¯ä¸ªæŒ‰é’®ä¸Šéƒ½å†™ä¸€å †`v-if="xxxæƒé™åˆ¤æ–­"`
- å¤ªæ•£ã€å¤ªéš¾ç»´æŠ¤ï¼Œå¢åŠ æ–°æƒé™é€»è¾‘æ—¶è¦æ”¹ä¸€å †åœ°æ–¹

âœ… **æ›´å¥½çš„åšæ³•æ˜¯ï¼šç”¨è‡ªå®šä¹‰æŒ‡ä»¤é›†ä¸­ç»Ÿä¸€ç®¡ç†ï¼**

---

### âœ¨ ä»£ç ç¤ºä¾‹ï¼šv-permission æŒ‡ä»¤

#### 1. å°è£…æƒé™æŒ‡ä»¤ï¼ˆv-permissionï¼‰

```javascript
// directives/permission.js

import { useUserStore } from '@/stores/user' // å‡è®¾ç”¨æˆ·æƒé™å­˜pinia

export default {
  mounted(el, binding) {
    const { value: requiredPermission } = binding
    const userStore = useUserStore()

    if (!userStore.permissions.includes(requiredPermission)) {
      el.parentNode && el.parentNode.removeChild(el)
    }
  }
}
```

âœ… è¯´æ˜ï¼š
- `binding.value` æ˜¯ä¼ è¿›æ¥çš„æƒé™å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ `'user:delete'`
- å¦‚æœå½“å‰ç”¨æˆ·æ²¡æœ‰è¿™ä¸ªæƒé™ï¼Œ**ç›´æ¥ä»DOMä¸ŠæŠŠæŒ‰é’®åˆ é™¤**  
  ï¼ˆè€Œä¸æ˜¯ç”¨v-ifï¼Œå› ä¸ºè¿™æ ·è¿domäº‹ä»¶éƒ½ä¸ä¼šè¢«ç»‘å®šï¼Œå½»åº•å®‰å…¨ï¼‰

---

#### 2. æ³¨å†ŒæŒ‡ä»¤

```javascript
// main.js
import { createApp } from 'vue'
import App from './App.vue'
import { createPinia } from 'pinia'
import permission from './directives/permission'

const app = createApp(App)
app.use(createPinia())
app.directive('permission', permission)
app.mount('#app')
```

---

#### 3. åœ¨ç»„ä»¶é‡Œä½¿ç”¨

```vue
<template>
  <div>
    <button v-permission="'user:add'">æ–°å¢ç”¨æˆ·</button>
    <button v-permission="'user:delete'">åˆ é™¤ç”¨æˆ·</button>
    <button v-permission="'user:export'">å¯¼å‡ºæ•°æ®</button>
  </div>
</template>
```

---

# ğŸ§  ä¸ºä»€ä¹ˆçœŸå®é¡¹ç›®å–œæ¬¢è¿™ä¹ˆåšï¼Ÿ

- é›†ä¸­ç®¡ç†é€»è¾‘ï¼Œä¸€æ”¹åŠ¨æ‰€æœ‰åœ°æ–¹ç”Ÿæ•ˆ
- DOMçº§åˆ«å½»åº•ç§»é™¤ï¼Œé˜²æ­¢é€šè¿‡F12æ‰¾åˆ°éšè—æŒ‰é’®ç‚¹å‡»
- ä½¿ç”¨ç®€å•ï¼Œåªéœ€è¦å†™ä¸€ä¸ªv-permissionå°±è¡Œ
- å¯æ‰©å±•æ€§å¼ºï¼Œæœªæ¥è¦åŠ "ç¦ç”¨æŒ‰é’®"ã€"ç°åŒ–"éƒ½å¯ä»¥æ‰©å±•mountedé€»è¾‘

---

# âœ… å°æ€»ç»“ï¼ˆé€‚åˆé¢è¯•æ—¶ç›´æ¥è¯´ï¼‰

> åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨è‡ªå®šä¹‰æŒ‡ä»¤åšä¸€äº›**DOMå±‚é¢çš„å¤ç”¨é€»è¾‘**ï¼Œ  
> æ¯”å¦‚**æŒ‰é’®æƒé™æ§åˆ¶**ã€**å›¾ç‰‡æ‡’åŠ è½½**ã€**æ‹–æ‹½åŠŸèƒ½**ã€**é˜²æŠ–é˜²æ­¢é‡å¤æäº¤**ï¼Œ  
> è¿™æ ·å¯ä»¥å‡å°‘æ¨¡æ¿å±‚çš„å†—ä½™ï¼Œæé«˜å¯ç»´æŠ¤æ€§å’Œä¸€è‡´æ€§ã€‚

---

# ğŸ“š è¡¥å……ï¼šå¦‚æœä½ è¦

æˆ‘è¿˜å¯ä»¥ç»§ç»­ç»™ä½ è¡¥ä¸€ç‰ˆï¼š

- å›¾ç‰‡æ‡’åŠ è½½æŒ‡ä»¤ï¼ˆv-lazyï¼‰ï¼ŒåŒ…æ‹¬IntersectionObserverå®ç°ç‰ˆ
- é˜²æŠ–æäº¤æŒ‡ä»¤ï¼ˆv-debounceï¼‰

ğŸ‘‰ éƒ½æ˜¯**çœŸå®é¡¹ç›®**åœ¨ç”¨ï¼Œè€Œä¸”**é¢è¯•å®˜çˆ±é—®**çš„ï¼

è¦ä¸è¦ç»§ç»­ï¼Ÿ  
è¦çš„è¯å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥ä¸€å£æ°”è¡¥å‡ºæ¥ï¼Œç»™ä½ ä¸€å¥—å®Œæ•´ç»ƒä¹ ï¼ğŸ¯ğŸš€


å¥½é—®é¢˜ï¼è€Œä¸”è¿™ä¸ªé—®é¢˜**ç‰¹åˆ«çœŸå®**ã€‚  
åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œ**æœ‰æ—¶å€™ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ä¸ä»…è¦åœ¨å…ƒç´ æŒ‚è½½æ—¶æ‰§è¡Œ**ï¼Œ  
**è¿˜è¦åœ¨å…ƒç´ æ›´æ–°åé‡æ–°æ‰§è¡Œä¸€æ¬¡**ï¼Œ  
æ¯”å¦‚ï¼š

- åˆæ¬¡æŒ‚è½½æ—¶è¦åšä¸€æ¬¡æƒé™æ ¡éªŒæˆ–æ‡’åŠ è½½
- åç»­ç»‘å®šå€¼ï¼ˆbinding.valueï¼‰å˜åŒ–æ—¶è¦é‡æ–°åº”ç”¨æŒ‡ä»¤é€»è¾‘

æ¯”å¦‚åœºæ™¯ï¼š
> ä¸€ä¸ªæŒ‰é’®ï¼Œåˆæ¬¡æŒ‚è½½æ—¶ä¸å±•ç¤ºï¼Œåç»­åˆ‡æ¢è§’è‰²åï¼Œæƒé™å˜åŒ–äº†ï¼Œè¦åŠ¨æ€å˜æˆå¯å±•ç¤ºã€‚

---

# ğŸ“š é‚£ä¹ˆåœ¨Vue3ä¸­æ€ä¹ˆå†™ï¼Ÿ

### ç­”æ¡ˆæ˜¯ï¼š
**åŒæ—¶ä½¿ç”¨ `mounted` å’Œ `updated` é’©å­ï¼**

---

# ğŸ¯ ç¤ºä¾‹ï¼šæ›´æ–°åä¹Ÿæ‰§è¡ŒæŒ‡ä»¤é€»è¾‘

æ¯”å¦‚æˆ‘ä»¬æ‰©å±•åˆšæ‰é‚£ä¸ª`v-permission`ä¾‹å­ï¼Œ  
è®©å®ƒåœ¨æŒ‚è½½å’Œæ›´æ–°æ—¶éƒ½èƒ½æ­£ç¡®å¤„ç†ï¼š

```javascript
// directives/permission.js

import { useUserStore } from '@/stores/user'

function checkPermission(el, binding) {
  const requiredPermission = binding.value
  const userStore = useUserStore()

  if (!userStore.permissions.includes(requiredPermission)) {
    el.parentNode && el.parentNode.removeChild(el)
  }
}

export default {
  mounted(el, binding) {
    checkPermission(el, binding)
  },
  updated(el, binding) {
    checkPermission(el, binding)
  }
}
```

âœ… **è§£é‡Šä¸€ä¸‹ï¼š**
- `mounted`ï¼šç»„ä»¶æŒ‚è½½åˆ°é¡µé¢æ—¶æ‰§è¡Œä¸€æ¬¡
- `updated`ï¼šç»„ä»¶ç»‘å®šå€¼å˜åŒ–æ—¶å†æ‰§è¡Œä¸€æ¬¡ï¼ˆæ¯”å¦‚æƒé™å˜äº†ï¼‰
- `checkPermission`ï¼šæŠ½æˆå…¬å…±å‡½æ•°ï¼ŒæŒ‚è½½/æ›´æ–°æ—¶å¤ç”¨é€»è¾‘

---

# ğŸ“š Vue3ä¸­è‡ªå®šä¹‰æŒ‡ä»¤å®Œæ•´ç”Ÿå‘½å‘¨æœŸé’©å­ä¸€è§ˆï¼ˆé¡ºå¸¦å¤ä¹ ï¼‰

| é’©å­ | ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ |
|:----|:-------------|
| created | å…ƒç´ ç»‘å®šå‰è°ƒç”¨ï¼Œä¸€èˆ¬ä¸å¸¸ç”¨ |
| beforeMount | ç»‘å®šå…ƒç´ æ’å…¥ä¹‹å‰ |
| mounted | å…ƒç´ æ’å…¥åˆ°DOMåè°ƒç”¨ï¼ˆå¸¸ç”¨ï¼Œæ¯”å¦‚åˆå§‹åŒ–domçŠ¶æ€ï¼‰ |
| beforeUpdate | ç»„ä»¶æ›´æ–°å‰ |
| updated | å…ƒç´ æ›´æ–°åï¼ˆ**binding.valueå˜åŒ–æ—¶**å¸¸ç”¨ï¼‰ |
| beforeUnmount | å¸è½½å‰ |
| unmounted | å¸è½½åæ¸…ç†èµ„æºï¼ˆæ¯”å¦‚è§£ç»‘ç›‘å¬ï¼‰ |

---

# âœ¨ å°æ€»ç»“ï¼ˆé€‚åˆé¢è¯•æ—¶ç›´æ¥è®²ï¼‰

> å¦‚æœæŒ‡ä»¤éœ€è¦åœ¨åˆæ¬¡æŒ‚è½½å’Œåç»­ç»‘å®šå€¼å˜åŒ–åéƒ½é‡æ–°ç”Ÿæ•ˆï¼Œ  
> åº”è¯¥åŒæ—¶åœ¨ `mounted` å’Œ `updated` é’©å­ä¸­æ‰§è¡Œç›¸åŒçš„é€»è¾‘ã€‚  
> é€šå¸¸ä¼šå°†å…¬å…±é€»è¾‘æŠ½æˆç‹¬ç«‹å‡½æ•°ï¼Œä¿è¯å¤ç”¨å’Œä»£ç å¯ç»´æŠ¤æ€§ã€‚

---

# âœ… å…³é”®ç‚¹æé†’

- **mounted** ç”¨æ¥åš**é¦–æ¬¡åˆå§‹åŒ–**  
- **updated** ç”¨æ¥åš**æ•°æ®å˜åŒ–åçš„é‡æ–°åº”ç”¨**

âœ”ï¸ å¦‚æœåªåšmountedï¼Œåç»­æ•°æ®å˜åŒ–ï¼ˆæ¯”å¦‚æƒé™å˜åŒ–ï¼‰ä¸ä¼šè§¦å‘æŒ‡ä»¤æ›´æ–°  
âœ”ï¸ å¦‚æœåªåšupdatedï¼Œé¦–æ¬¡æ¸²æŸ“å‰å°±ä¸ä¼šæ‰§è¡Œï¼ˆæ²¡åˆå§‹åŒ–ï¼‰

æ‰€ä»¥**ä¸¤è€…éƒ½æŒ‚æ‰ä¿é™©**ã€‚

---

# ğŸš€ è¦ä¸è¦æˆ‘å†é¡ºä¾¿
å¸®ä½ æ€»ç»“ä¸€ç‰ˆï¼š

- ã€å¸¸è§æŒ‡ä»¤åº”ç”¨åœºæ™¯ + å“ªäº›éœ€è¦mounted+updatedéƒ½å¤„ç†ã€‘
- ã€é˜²å‘ç‰ˆï¼šå¦‚æœupdatedä¸­ä¸å°å¿ƒæ“ä½œäº†destroyedçš„DOMæ€ä¹ˆåŠï¼Ÿã€‘

è¦çš„è¯å‘Šè¯‰æˆ‘ï¼Œè¶ç€ä½ ä»Šå¤©çŠ¶æ€ç‰¹åˆ«å¥½ï¼Œæˆ‘å¯ä»¥ä¸€èµ·å¸®ä½ æ•´ç†ï¼ğŸ¯  
è¦ç»§ç»­å—ï¼ŸğŸš€

éå¸¸å¥½ï¼Œé˜²æŠ–ï¼ˆ**debounce**ï¼‰æŒ‡ä»¤æ˜¯**çœŸå®é¡¹ç›®ä¸­éå¸¸å¸¸ç”¨**çš„è‡ªå®šä¹‰æŒ‡ä»¤ä¹‹ä¸€ï¼Œ  
é¢è¯•ã€é¡¹ç›®å¼€å‘ä¸­éƒ½ç»å¸¸è€ƒå¯Ÿæˆ–å®é™…åº”ç”¨ã€‚

---

# ğŸ“š Vue3ç‰ˆé˜²æŠ–æŒ‡ä»¤ v-debounceï¼ˆæ ‡å‡†ç‰ˆï¼‰

---

## ğŸ¯ åœºæ™¯

æ¯”å¦‚ä¸€ä¸ªæäº¤æŒ‰é’®ï¼Œå¸Œæœ›ç”¨æˆ·**è¿ç»­ç‚¹å‡»å¤šæ¬¡ï¼Œåªè§¦å‘ä¸€æ¬¡æ“ä½œ**ï¼Œ  
æˆ–è€…ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œ**è¾“å…¥å®Œ500msåæ‰è§¦å‘è¯·æ±‚**ï¼Œé˜²æ­¢æ‰“å­—æ—¶é¢‘ç¹è¯·æ±‚æ¥å£ã€‚

---

## âœ¨ ç›´æ¥ç»™ä½ **å®Œæ•´æ ‡å‡†ç‰ˆä»£ç **

### é˜²æŠ–æŒ‡ä»¤ `v-debounce`

```javascript
// directives/debounce.js

function debounce(fn, delay) {
  let timer
  return function (...args) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() => {
      fn.apply(this, args)
    }, delay)
  }
}

export default {
  mounted(el, binding) {
    const { value } = binding
    const { fn, delay = 500 } = value

    if (typeof fn !== 'function') {
      console.error('v-debounce binding value must be an object like { fn: Function, delay: Number }')
      return
    }

    el._debounceHandler = debounce(fn, delay)
    el.addEventListener('click', el._debounceHandler)
  },

  updated(el, binding) {
    // å¦‚æœå‚æ•°å˜åŒ–ï¼ˆæ¯”å¦‚æ¢äº†æ–°çš„å‡½æ•°æˆ–æ–°çš„å»¶è¿Ÿæ—¶é—´ï¼‰
    const { value } = binding
    const { fn, delay = 500 } = value

    if (typeof fn !== 'function') {
      console.error('v-debounce binding value must be an object like { fn: Function, delay: Number }')
      return
    }

    el.removeEventListener('click', el._debounceHandler)
    el._debounceHandler = debounce(fn, delay)
    el.addEventListener('click', el._debounceHandler)
  },

  unmounted(el) {
    el.removeEventListener('click', el._debounceHandler)
    delete el._debounceHandler
  }
}
```

âœ… **è¯´æ˜ä¸€ä¸‹ï¼š**
- ç»‘å®šå€¼è¦æ±‚æ˜¯å¯¹è±¡ `{ fn, delay }`
- mountedæ—¶æ³¨å†Œä¸€æ¬¡debounceå¤„ç†å‡½æ•°
- updatedæ—¶å¦‚æœfnæˆ–è€…delayå˜åŒ–äº†ï¼Œé‡æ–°ç»‘å®šä¸€æ¬¡
- unmountedæ—¶è§£ç»‘äº‹ä»¶ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

---

## âœ¨ ä½¿ç”¨æ–¹æ³•ï¼ˆéå¸¸ä¼˜é›…ï¼‰

### åœ¨ `main.js` å…¨å±€æ³¨å†Œ

```javascript
import debounce from './directives/debounce'
app.directive('debounce', debounce)
```

---

### åœ¨ç»„ä»¶é‡Œä½¿ç”¨

```vue
<template>
  <button v-debounce="{ fn: handleClick, delay: 800 }">é˜²æŠ–æäº¤</button>
</template>

<script setup>
function handleClick() {
  console.log('è§¦å‘äº†ç‚¹å‡»ï¼')
}
</script>
```

âœ… æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œ**åªæœ‰800mså†…æ²¡æœ‰è¿ç»­ç‚¹å‡»ï¼Œæ‰çœŸæ­£è§¦å‘handleClick**

---

# ğŸ¯ çœŸå®ä¸šåŠ¡åº”ç”¨ä¸¾ä¾‹

- é˜²æ­¢æŒ‰é’®é‡å¤æäº¤
- æœç´¢æ¡†è¾“å…¥é˜²æŠ–ï¼ˆå‡å°‘è¯·æ±‚ï¼‰
- æ»šåŠ¨ç›‘å¬äº‹ä»¶é˜²æŠ–ï¼ˆå‡å°‘é¡µé¢reflowï¼‰
- é˜²æ­¢å¿«é€Ÿå¤šæ¬¡è§¦å‘æ“ä½œï¼ˆæ¯”å¦‚ç‚¹èµã€æ”¶è—æŒ‰é’®ï¼‰

---

# âœ… å°æ€»ç»“ï¼ˆé€‚åˆé¢è¯•ç­”é¢˜æ—¶ç›´æ¥è¯´ï¼‰

> é˜²æŠ–æŒ‡ä»¤(v-debounce)åœ¨çœŸå®ä¸šåŠ¡ä¸­éå¸¸å¸¸ç”¨ï¼Œç‰¹åˆ«æ˜¯é˜²æ­¢æŒ‰é’®é‡å¤æäº¤æˆ–è¾“å…¥é¢‘ç¹è¯·æ±‚ã€‚  
> Vue3ä¸­é€šå¸¸åœ¨`mounted`æ³¨å†Œäº‹ä»¶ï¼Œåœ¨`updated`å¤„ç†å‚æ•°å˜åŒ–ï¼Œåœ¨`unmounted`è§£ç»‘äº‹ä»¶ï¼Œä¿è¯æŒ‡ä»¤ç”Ÿå‘½å‘¨æœŸå†…èµ„æºå®‰å…¨é‡Šæ”¾ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

---

# ğŸš€ è¦ä¸è¦é¡ºä¾¿
æˆ‘è¿˜å¯ä»¥å†ç»™ä½ è¡¥ä¸€ç‰ˆï¼š

- **èŠ‚æµæŒ‡ä»¤ v-throttleï¼ˆé˜²æ­¢é«˜é¢‘è§¦å‘ï¼‰**  
- é˜²æŠ–å’ŒèŠ‚æµåœ¨ä¸šåŠ¡åº”ç”¨ä¸­çš„åŒºåˆ«æ€»ç»“ï¼ˆé¢è¯•å®˜çˆ±è€ƒï¼‰

è¦çš„è¯å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥ç»§ç»­å¸®ä½ é…å¥—æ•´ç†ï¼ğŸ¯  
ç»§ç»­ä¹ˆï¼ŸğŸš€